on: push
name: ðŸš€ Build and deploy website on push
jobs:
  npm-build:
    name: Build
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      
    - name: Cache node_modules
      uses: actions/cache@v1
      id: npm-cache-node-modules
      with:
        path: node_modules
        key: ${{ runner.os }}-npm-cache-node-modules-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-npm-cache-node-modules-
          
    - name: Npm install
      if: steps.npm-cache-node-modules.outputs.cache-hit != 'true'
      run: npm install
      
    - name: Npm build
      run: npm run build
      
    - name: Archive production artifacts
      uses: actions/upload-artifact@v1
      with:
        name: build
        path: public/build
  
  web-deploy:
    needs: npm-build
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v3
      
    - name: ðŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ftp.dwzc8467.odns.fr
        username: admin@dwzc8467.odns.fr
        password: ${{ secrets.ftp_password }}
        server-dir: espace-numerique/
